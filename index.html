<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新标签页</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- 引入 Google Fonts: Outfit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Outfit', sans-serif; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        
        .glass-panel {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        /* 隐藏搜索框默认的 X */
        input[type="search"]::-webkit-search-decoration,
        input[type="search"]::-webkit-search-cancel-button,
        input[type="search"]::-webkit-search-results-button,
        input[type="search"]::-webkit-search-results-decoration { display: none; }
        
        /* 图标加载失败时的样式 */
        .favicon-img {
            object-fit: contain;
        }
    </style>
</head>
<body class="min-h-screen transition-colors duration-500 ease-in-out font-sans selection:bg-blue-200 selection:text-blue-900 overflow-x-hidden flex flex-col bg-gray-50 text-gray-800 dark:bg-slate-900 dark:text-slate-100">

    <!-- 顶部导航 -->
    <header class="absolute top-0 right-0 p-6 flex items-center gap-4 z-20">
        <div id="date-display" class="text-sm font-medium opacity-60 hover:opacity-100 transition-opacity cursor-default hidden md:block"></div>
        
        <!-- 编辑模式开关 -->
        <button id="btn-edit" class="p-2 rounded-full transition-all duration-300 flex items-center gap-2 bg-white hover:bg-gray-100 text-slate-600 shadow-sm dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-400" title="自定义主页">
            <i data-lucide="settings" class="w-[18px] h-[18px]" id="icon-settings"></i>
            <i data-lucide="check" class="w-[18px] h-[18px] hidden" id="icon-check"></i>
            <span id="text-edit-done" class="text-xs font-bold pr-1 hidden">完成</span>
        </button>

        <!-- 恢复默认按钮 -->
        <button id="btn-reset" class="hidden p-2 rounded-full bg-red-50 text-red-500 hover:bg-red-100 transition-all text-xs font-medium" title="恢复默认设置">
            <i data-lucide="rotate-ccw" class="w-[18px] h-[18px]"></i>
        </button>

        <!-- 主题切换 -->
        <button id="btn-theme" class="p-2 rounded-full transition-all duration-300 bg-white hover:bg-gray-100 text-slate-600 shadow-sm dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-yellow-400" title="切换主题">
            <i data-lucide="moon" class="w-[18px] h-[18px] block dark:hidden"></i>
            <i data-lucide="sun" class="w-[18px] h-[18px] hidden dark:block"></i>
        </button>
    </header>

    <!-- 主体内容 -->
    <main id="main-container" class="flex-1 container mx-auto px-4 flex flex-col justify-center items-center max-w-4xl transition-all duration-500 py-10">
        
        <!-- 欢迎语 & 时钟 -->
        <div id="greeting-section" class="text-center mb-12 animate-fade-in-up transition-all duration-300">
            <h1 id="clock-time" class="text-7xl md:text-8xl font-medium tracking-tight mb-4 tabular-nums cursor-default select-none text-gray-800 dark:text-white">00:00</h1>
            <p id="greeting-text" class="text-lg md:text-xl font-normal text-gray-500 dark:text-slate-400">Loading...</p>
        </div>

        <!-- 搜索框 -->
        <div id="search-container" class="w-full max-w-2xl mb-12 relative group z-10 transition-all duration-300">
            <form id="search-form" class="relative">
                <div class="absolute inset-y-0 left-0 pl-5 flex items-center pointer-events-none transition-colors text-gray-400 group-hover:text-blue-500 dark:text-slate-500">
                    <i data-lucide="search" class="w-[22px] h-[22px]"></i>
                </div>
                <input id="search-input" type="text" placeholder="Search Bing..." class="w-full pl-14 pr-36 py-4 rounded-full text-lg shadow-sm hover:shadow-md focus:shadow-lg transition-all duration-300 outline-none border bg-white border-transparent focus:border-blue-100 text-gray-800 placeholder-gray-300 dark:bg-slate-800 dark:border-slate-700 dark:focus:border-slate-600 dark:text-white dark:placeholder-slate-500">
                <div class="absolute inset-y-0 right-2 flex items-center">
                    <div class="flex items-center p-1 rounded-full bg-gray-100 dark:bg-slate-700/50">
                        <!-- 调整顺序：Bing 在前，Google 在后 -->
                        <button type="button" data-engine="bing" class="engine-btn px-3 py-1 rounded-full text-xs font-bold transition-all duration-200 bg-white text-blue-600 shadow-sm dark:bg-slate-600 dark:text-white">B</button>
                        <button type="button" data-engine="google" class="engine-btn px-3 py-1 rounded-full text-xs font-bold transition-all duration-200 text-gray-400 hover:text-gray-600 dark:text-slate-400 dark:hover:text-slate-200">G</button>
                        
                        <!-- 分割线 -->
                        <div class="w-px h-4 mx-2 bg-gray-300 dark:bg-slate-600"></div>
                        
                        <!-- 钱包按钮 -->
                        <button type="button" onclick="openFinanceModal()" class="p-1.5 rounded-full text-gray-400 hover:text-green-600 dark:text-slate-400 dark:hover:text-green-400 transition-colors" title="我的钱包">
                            <i data-lucide="wallet" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- 链接网格 (官网图标版) -->
        <div id="shortcuts-container" class="w-full grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8 gap-4 sm:gap-6 justify-items-center animate-fade-in-up pb-20" style="animation-delay: 0.1s;">
            <!-- 内容由 JS 动态生成 -->
        </div>
    </main>

    <footer class="fixed bottom-0 w-full p-4 text-center pointer-events-none">
        <p class="text-xs text-gray-300 dark:text-slate-700">Designed for Focus & Efficiency</p>
    </footer>

    <!-- 弹窗：添加链接 -->
    <div id="modal-add-link" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 hidden">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-in-up">
            <div class="p-6">
                <h3 class="text-xl font-bold mb-4 dark:text-white">添加快捷方式</h3>
                <form id="form-add-link" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1 dark:text-slate-300">名称</label>
                        <input id="input-link-name" type="text" placeholder="例如: Bilibili" class="w-full p-2 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1 dark:text-slate-300">网址</label>
                        <input id="input-link-url" type="text" placeholder="例如: bilibili.com" class="w-full p-2 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1 dark:text-slate-300">分类 (用于数据整理)</label>
                        <select id="input-link-category" class="w-full p-2 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                            <!-- JS 填充 -->
                        </select>
                    </div>
                    <!-- 移除了图标选择器，因为现在是自动获取 -->
                    
                    <div class="flex gap-3 mt-6 pt-2">
                        <button type="button" id="btn-cancel-add" class="flex-1 py-2 rounded-lg border hover:bg-gray-50 dark:border-slate-600 dark:hover:bg-slate-700 dark:text-slate-300">取消</button>
                        <button type="submit" class="flex-1 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white">添加</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 弹窗：财务概览 -->
    <div id="modal-finance" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 hidden">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-fade-in-up">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold dark:text-white flex items-center gap-2">
                        <i data-lucide="wallet" class="w-5 h-5 text-green-500"></i>
                        财务概览
                    </h3>
                    <button onclick="closeFinanceModal()" class="text-gray-400 hover:text-gray-600 dark:text-slate-500 dark:hover:text-slate-300"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="p-4 rounded-xl bg-gray-50 dark:bg-slate-700/50 text-center border border-gray-100 dark:border-slate-600">
                        <div class="text-xs text-gray-500 dark:text-slate-400 mb-1 uppercase tracking-wider">本月支出</div>
                        <div class="text-lg font-bold text-gray-800 dark:text-white" id="modal-finance-spent">¥0.00</div>
                    </div>
                    <div class="p-4 rounded-xl bg-gray-50 dark:bg-slate-700/50 text-center border border-gray-100 dark:border-slate-600">
                        <div class="text-xs text-gray-500 dark:text-slate-400 mb-1 uppercase tracking-wider">当前余额</div>
                        <div class="text-lg font-bold text-green-600 dark:text-green-400" id="modal-finance-balance">¥0.00</div>
                    </div>
                </div>
                <div class="border-t border-gray-100 dark:border-slate-700 pt-5">
                    <p class="text-xs text-gray-400 dark:text-slate-500 mb-3 ml-1">更新余额 (系统自动计算差额为支出)</p>
                    <form id="form-finance" class="flex gap-2">
                        <input id="input-balance" type="number" step="0.01" placeholder="输入最新余额" class="flex-1 p-2.5 rounded-lg border bg-gray-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:ring-2 focus:ring-green-500 outline-none font-mono text-sm" required>
                        <button type="submit" class="px-5 py-2.5 rounded-lg bg-green-600 hover:bg-green-700 text-white font-medium text-sm transition-colors shadow-sm">更新</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. 配置与状态 ---
        const DEFAULT_CATEGORIES = [
            {
                id: 'ai', title: 'AI 助手', color: 'text-purple-500',
                links: [
                    { name: 'ChatGPT', url: 'https://chat.openai.com/' },
                    { name: 'Claude', url: 'https://claude.ai/' },
                    { name: 'Gemini', url: 'https://gemini.google.com/' },
                ]
            },
            {
                id: 'research', title: '学术 & 科研', color: 'text-blue-500',
                links: [
                    { name: 'Google Scholar', url: 'https://scholar.google.com/' },
                    { name: 'ArXiv', url: 'https://arxiv.org/' },
                    { name: 'Papers w/ Code', url: 'https://paperswithcode.com/' },
                ]
            },
            {
                id: 'dev', title: '开发社区', color: 'text-emerald-500',
                links: [
                    { name: 'GitHub', url: 'https://github.com/' },
                    { name: 'Stack Overflow', url: 'https://stackoverflow.com/' },
                    { name: 'V2EX', url: 'https://www.v2ex.com/' },
                ]
            },
            {
                id: 'ent', title: '摸鱼时间', color: 'text-orange-500',
                links: [
                    { name: 'Bilibili', url: 'https://www.bilibili.com/' },
                    { name: 'YouTube', url: 'https://www.youtube.com/' },
                    { name: '抖音', url: 'https://www.douyin.com/' },
                ]
            }
        ];

        // 每日问候语库
        const DAILY_GREETINGS = [
            "保持渴望，保持愚蠢。", 
            "代码如诗，逻辑为魂。", 
            "今天的努力是明天的基石。", 
            "不仅要写代码，更要改变世界。",
            "休息是为了走更远的路。",
            "Keep it simple, stupid.",
            "Stay Focus, Stay Efficient.",
            "每一个 Bug 都是学习的机会。",
            "喝杯咖啡，放松一下。",
            "灵感总在不经意间降临。",
            "做难事必有所得。",
            "Hello World, Hello Future."
        ];

        let state = {
            categories: JSON.parse(localStorage.getItem('myStartPageData')) || DEFAULT_CATEGORIES,
            isEditing: false,
            searchEngine: 'bing', // 默认 Bing
            isDarkMode: localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches),
            financeLogs: JSON.parse(localStorage.getItem('myFinanceLogs')) || []
        };

        // --- 2. 核心功能函数 ---

        function init() {
            if (state.isDarkMode) document.documentElement.classList.add('dark');
            
            updateClock();
            setInterval(updateClock, 1000);
            
            renderShortcuts();
            updateEngineUI();
            lucide.createIcons();
            
            document.getElementById('search-input').focus();
        }

        function saveState() {
            localStorage.setItem('myStartPageData', JSON.stringify(state.categories));
        }
        
        function saveFinance() {
            localStorage.setItem('myFinanceLogs', JSON.stringify(state.financeLogs));
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock-time').innerText = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
            document.getElementById('date-display').innerText = now.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric', weekday: 'long' });
            
            const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const greetingIndex = dayOfYear % DAILY_GREETINGS.length;
            document.getElementById('greeting-text').innerText = DAILY_GREETINGS[greetingIndex];
        }

        function toggleTheme() {
            state.isDarkMode = !state.isDarkMode;
            if (state.isDarkMode) {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            }
        }

        function toggleEditMode() {
            state.isEditing = !state.isEditing;
            const btn = document.getElementById('btn-edit');
            const main = document.getElementById('main-container');
            const searchContainer = document.getElementById('search-container');
            const greeting = document.getElementById('greeting-section');
            const btnReset = document.getElementById('btn-reset');

            if (state.isEditing) {
                btn.className = "p-2 rounded-full transition-all duration-300 flex items-center gap-2 bg-blue-100 text-blue-600 ring-2 ring-blue-500";
                document.getElementById('icon-settings').classList.add('hidden');
                document.getElementById('icon-check').classList.remove('hidden');
                document.getElementById('text-edit-done').classList.remove('hidden');
                greeting.classList.add('opacity-50', 'blur-[1px]');
                btnReset.classList.remove('hidden');
            } else {
                btn.className = "p-2 rounded-full transition-all duration-300 flex items-center gap-2 bg-white hover:bg-gray-100 text-slate-600 shadow-sm dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-400";
                document.getElementById('icon-settings').classList.remove('hidden');
                document.getElementById('icon-check').classList.add('hidden');
                document.getElementById('text-edit-done').classList.add('hidden');
                greeting.classList.remove('opacity-50', 'blur-[1px]');
                btnReset.classList.add('hidden');
            }
            renderShortcuts();
        }

        function updateEngineUI() {
            const input = document.getElementById('search-input');
            const btns = document.querySelectorAll('.engine-btn');

            btns.forEach(btn => {
                const engine = btn.dataset.engine;
                if (engine === state.searchEngine) {
                    btn.className = 'engine-btn px-3 py-1 rounded-full text-xs font-bold transition-all duration-200 bg-white text-blue-600 shadow-sm dark:bg-slate-600 dark:text-white';
                } else {
                    btn.className = 'engine-btn px-3 py-1 rounded-full text-xs font-bold transition-all duration-200 text-gray-400 hover:text-gray-600 dark:text-slate-400 dark:hover:text-slate-200';
                }
            });

            input.placeholder = `Search ${state.searchEngine === 'google' ? 'Google' : 'Bing'}...`;
        }

        // --- 财务逻辑 ---
        window.openFinanceModal = () => {
            document.getElementById('modal-finance').classList.remove('hidden');
            const lastLog = state.financeLogs.length > 0 ? state.financeLogs[state.financeLogs.length - 1] : { balance: 0 };
            document.getElementById('modal-finance-balance').innerText = '¥ ' + parseFloat(lastLog.balance).toLocaleString('zh-CN', {minimumFractionDigits: 2});

            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const thisMonthLogs = state.financeLogs.filter(log => {
                const d = new Date(log.date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            }).sort((a, b) => new Date(a.date) - new Date(b.date));

            let totalSpent = 0;
            for (let i = 1; i < thisMonthLogs.length; i++) {
                const prev = thisMonthLogs[i-1].balance;
                const curr = thisMonthLogs[i].balance;
                if (curr < prev) totalSpent += (prev - curr);
            }
            document.getElementById('modal-finance-spent').innerText = '¥ ' + totalSpent.toLocaleString('zh-CN', {minimumFractionDigits: 2});
            const input = document.getElementById('input-balance');
            input.value = lastLog.balance || '';
            input.focus();
        };

        window.closeFinanceModal = () => { document.getElementById('modal-finance').classList.add('hidden'); };

        document.getElementById('form-finance').addEventListener('submit', (e) => {
            e.preventDefault();
            const balanceVal = parseFloat(document.getElementById('input-balance').value);
            if (isNaN(balanceVal)) return;
            state.financeLogs.push({ date: new Date().toISOString(), balance: balanceVal });
            state.financeLogs.sort((a, b) => new Date(a.date) - new Date(b.date));
            saveFinance();
            openFinanceModal();
        });

        // --- 渲染逻辑 (自动获取图标) ---

        function getFaviconUrl(url) {
            // Google Favicon Service
            return `https://www.google.com/s2/favicons?domain_url=${encodeURIComponent(url)}&sz=128`;
        }

        function renderShortcuts() {
            const container = document.getElementById('shortcuts-container');
            container.innerHTML = '';

            state.categories.forEach(cat => {
                cat.links.forEach((link, linkIndex) => {
                    const item = document.createElement('div');
                    item.className = 'relative group';
                    
                    const faviconSrc = getFaviconUrl(link.url);

                    const contentHtml = `
                        <a href="${state.isEditing ? 'javascript:void(0)' : link.url}" 
                           target="${state.isEditing ? '' : '_blank'}"
                           class="flex flex-col items-center gap-3 p-4 rounded-xl transition-all duration-200 group-hover:bg-white/50 dark:group-hover:bg-white/10 ${state.isEditing ? 'cursor-default opacity-80' : ''}">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-white shadow-sm dark:bg-slate-800 overflow-hidden p-2.5">
                                <img src="${faviconSrc}" alt="${link.name}" class="w-full h-full object-contain favicon-img" onerror="this.src='https://www.google.com/s2/favicons?domain=example.com&sz=128'">
                            </div>
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300 w-24 text-center truncate">${link.name}</span>
                        </a>
                    `;
                    
                    const deleteBtnHtml = state.isEditing ? `
                        <button onclick="deleteLink('${cat.id}', ${linkIndex})" class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-1.5 shadow-md hover:bg-red-600 transition-all z-10 scale-0 group-hover:scale-100">
                            <i data-lucide="x" class="w-3 h-3"></i>
                        </button>
                    ` : '';

                    item.innerHTML = contentHtml + deleteBtnHtml;
                    container.appendChild(item);
                });
            });

            if (state.isEditing) {
                const addBtn = document.createElement('button');
                addBtn.onclick = () => openAddModal();
                addBtn.className = "flex flex-col items-center gap-3 p-4 rounded-xl transition-all duration-200 hover:bg-white/50 dark:hover:bg-white/10 group";
                addBtn.innerHTML = `
                    <div class="w-12 h-12 rounded-full flex items-center justify-center transition-colors bg-gray-100 text-gray-400 dark:bg-slate-800 dark:text-slate-500 group-hover:text-blue-500">
                        <i data-lucide="plus" class="w-6 h-6"></i>
                    </div>
                    <span class="text-sm font-medium text-gray-400 dark:text-gray-500 w-24 text-center">添加</span>
                `;
                container.appendChild(addBtn);
            }

            lucide.createIcons();
        }

        // --- 事件监听 ---

        document.getElementById('search-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const term = document.getElementById('search-input').value.trim();
            if (!term) return;
            window.location.href = state.searchEngine === 'google' 
                ? `https://www.google.com/search?q=${encodeURIComponent(term)}`
                : `https://www.bing.com/search?q=${encodeURIComponent(term)}`;
        });

        document.querySelectorAll('.engine-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                state.searchEngine = btn.dataset.engine;
                updateEngineUI();
                document.getElementById('search-input').focus();
            });
        });

        document.getElementById('btn-theme').addEventListener('click', toggleTheme);
        document.getElementById('btn-edit').addEventListener('click', toggleEditMode);
        document.getElementById('btn-reset').addEventListener('click', () => {
            if (confirm('确定要恢复默认设置吗？')) {
                state.categories = JSON.parse(JSON.stringify(DEFAULT_CATEGORIES));
                saveState();
                toggleEditMode();
            }
        });

        window.openAddModal = () => {
            document.getElementById('modal-add-link').classList.remove('hidden');
            const catSelect = document.getElementById('input-link-category');
            catSelect.innerHTML = '';
            state.categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.id;
                option.text = cat.title;
                option.className = "text-gray-800 dark:text-gray-200 dark:bg-slate-800";
                catSelect.appendChild(option);
            });
            document.getElementById('input-link-name').focus();
        }

        document.getElementById('btn-cancel-add').addEventListener('click', () => {
            document.getElementById('modal-add-link').classList.add('hidden');
            document.getElementById('form-add-link').reset();
        });

        document.getElementById('form-add-link').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('input-link-name').value;
            let url = document.getElementById('input-link-url').value;
            const catId = document.getElementById('input-link-category').value;

            if (name && url && catId) {
                if (!url.startsWith('http')) url = 'https://' + url;
                const newLink = { name, url };
                
                state.categories = state.categories.map(cat => {
                    if (cat.id === catId) return { ...cat, links: [...cat.links, newLink] };
                    return cat;
                });
                saveState();
                renderShortcuts();
                document.getElementById('modal-add-link').classList.add('hidden');
                document.getElementById('form-add-link').reset();
            }
        });

        window.deleteLink = (catId, index) => {
            if (confirm('确定删除?')) {
                state.categories = state.categories.map(cat => {
                    if (cat.id === catId) {
                        const newLinks = [...cat.links];
                        newLinks.splice(index, 1);
                        return { ...cat, links: newLinks };
                    }
                    return cat;
                });
                saveState();
                renderShortcuts();
            }
        };

        init();
    </script>
</body>
</html>
