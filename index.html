<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新建标签页</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        
        .glass-panel {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
    </style>
</head>
<body class="min-h-screen transition-colors duration-500 ease-in-out font-sans selection:bg-blue-200 selection:text-blue-900 overflow-x-hidden flex flex-col bg-gray-50 text-gray-800 dark:bg-slate-900 dark:text-slate-100">

    <!-- 顶部导航 -->
    <header class="absolute top-0 right-0 p-6 flex items-center gap-4 z-20">
        <div id="date-display" class="text-sm font-medium opacity-60 hover:opacity-100 transition-opacity cursor-default hidden md:block"></div>
        
        <!-- 编辑模式开关 -->
        <button id="btn-edit" class="p-2 rounded-full transition-all duration-300 flex items-center gap-2 bg-white hover:bg-gray-100 text-slate-600 shadow-sm dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-400" title="自定义主页">
            <i data-lucide="settings" class="w-[18px] h-[18px]" id="icon-settings"></i>
            <i data-lucide="check" class="w-[18px] h-[18px] hidden" id="icon-check"></i>
            <span id="text-edit-done" class="text-xs font-bold pr-1 hidden">完成</span>
        </button>

        <!-- 恢复默认按钮 -->
        <button id="btn-reset" class="hidden p-2 rounded-full bg-red-50 text-red-500 hover:bg-red-100 transition-all text-xs font-medium" title="恢复默认设置">
            <i data-lucide="rotate-ccw" class="w-[18px] h-[18px]"></i>
        </button>

        <!-- 主题切换 -->
        <button id="btn-theme" class="p-2 rounded-full transition-all duration-300 bg-white hover:bg-gray-100 text-slate-600 shadow-sm dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-yellow-400" title="切换主题">
            <i data-lucide="moon" class="w-[18px] h-[18px] block dark:hidden"></i>
            <i data-lucide="sun" class="w-[18px] h-[18px] hidden dark:block"></i>
        </button>
    </header>

    <!-- 主体内容 -->
    <main id="main-container" class="flex-1 container mx-auto px-4 flex flex-col justify-center items-center max-w-5xl transition-all duration-500 py-10">
        
        <!-- 欢迎语 & 时钟 -->
        <div id="greeting-section" class="text-center mb-10 animate-fade-in-up transition-all duration-300">
            <h1 id="clock-time" class="text-6xl md:text-8xl font-light tracking-tight mb-4 tabular-nums cursor-default select-none">00:00</h1>
            <p id="greeting-text" class="text-lg md:text-xl font-light text-gray-500 dark:text-slate-400">Loading...</p>
        </div>

        <!-- 搜索框 -->
        <div id="search-container" class="w-full max-w-2xl mb-12 relative group z-10 transition-all duration-300">
            <form id="search-form" class="relative">
                <div class="absolute inset-y-0 left-0 pl-5 flex items-center pointer-events-none transition-colors text-gray-400 group-hover:text-blue-500 dark:text-slate-500">
                    <i data-lucide="search" class="w-[22px] h-[22px]"></i>
                </div>
                <input id="search-input" type="text" placeholder="Search Google..." class="w-full pl-14 pr-36 py-4 rounded-full text-lg shadow-sm hover:shadow-md focus:shadow-lg transition-all duration-300 outline-none border bg-white border-transparent focus:border-blue-100 text-gray-800 placeholder-gray-300 dark:bg-slate-800 dark:border-slate-700 dark:focus:border-slate-600 dark:text-white dark:placeholder-slate-500">
                <div class="absolute inset-y-0 right-2 flex items-center">
                    <div class="flex items-center p-1 rounded-full bg-gray-100 dark:bg-slate-700/50">
                        <button type="button" data-engine="google" class="engine-btn px-3 py-1 rounded-full text-xs font-bold transition-all duration-200 bg-white text-blue-600 shadow-sm dark:bg-slate-600 dark:text-white">G</button>
                        <button type="button" data-engine="bing" class="engine-btn px-3 py-1 rounded-full text-xs font-bold transition-all duration-200 text-gray-400 hover:text-gray-600 dark:text-slate-400 dark:hover:text-slate-200">B</button>
                        
                        <!-- 分割线 -->
                        <div class="w-px h-4 mx-2 bg-gray-300 dark:bg-slate-600"></div>
                        
                        <!-- 钱包按钮 (隐蔽入口) -->
                        <button type="button" onclick="openFinanceModal()" class="p-1.5 rounded-full text-gray-400 hover:text-green-600 dark:text-slate-400 dark:hover:text-green-400 transition-colors" title="我的钱包">
                            <i data-lucide="wallet" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- 链接卡片网格 -->
        <div id="categories-grid" class="w-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 animate-fade-in-up pb-20" style="animation-delay: 0.1s;">
            <!-- 内容由 JS 动态生成 -->
        </div>
    </main>

    <footer class="fixed bottom-0 w-full p-4 text-center pointer-events-none">
        <p class="text-xs text-gray-300 dark:text-slate-700">Designed for Focus & Efficiency</p>
    </footer>

    <!-- 弹窗：添加链接 -->
    <div id="modal-add-link" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 hidden">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-in-up">
            <div class="p-6">
                <h3 class="text-xl font-bold mb-4 dark:text-white">添加链接</h3>
                <form id="form-add-link" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1 dark:text-slate-300">名称</label>
                        <input id="input-link-name" type="text" class="w-full p-2 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1 dark:text-slate-300">网址</label>
                        <input id="input-link-url" type="text" class="w-full p-2 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2 dark:text-slate-300">图标</label>
                        <div id="icon-selector" class="flex gap-2 flex-wrap"></div>
                    </div>
                    <div class="flex gap-3 mt-6 pt-2">
                        <button type="button" id="btn-cancel-add" class="flex-1 py-2 rounded-lg border hover:bg-gray-50 dark:border-slate-600 dark:hover:bg-slate-700 dark:text-slate-300">取消</button>
                        <button type="submit" class="flex-1 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white">添加</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 弹窗：财务概览 & 更新 -->
    <div id="modal-finance" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 hidden">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-fade-in-up">
            <div class="p-6">
                <!-- 头部 -->
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold dark:text-white flex items-center gap-2">
                        <i data-lucide="wallet" class="w-5 h-5 text-green-500"></i>
                        财务概览
                    </h3>
                    <button onclick="closeFinanceModal()" class="text-gray-400 hover:text-gray-600 dark:text-slate-500 dark:hover:text-slate-300"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>

                <!-- 数据展示区 (点击后才看得到) -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="p-4 rounded-xl bg-gray-50 dark:bg-slate-700/50 text-center border border-gray-100 dark:border-slate-600">
                        <div class="text-xs text-gray-500 dark:text-slate-400 mb-1 uppercase tracking-wider">本月支出</div>
                        <div class="text-lg font-bold text-gray-800 dark:text-white" id="modal-finance-spent">¥0.00</div>
                    </div>
                    <div class="p-4 rounded-xl bg-gray-50 dark:bg-slate-700/50 text-center border border-gray-100 dark:border-slate-600">
                        <div class="text-xs text-gray-500 dark:text-slate-400 mb-1 uppercase tracking-wider">当前余额</div>
                        <div class="text-lg font-bold text-green-600 dark:text-green-400" id="modal-finance-balance">¥0.00</div>
                    </div>
                </div>

                <!-- 更新表单 -->
                <div class="border-t border-gray-100 dark:border-slate-700 pt-5">
                    <p class="text-xs text-gray-400 dark:text-slate-500 mb-3 ml-1">更新余额 (系统自动计算差额为支出)</p>
                    <form id="form-finance" class="flex gap-2">
                        <input id="input-balance" type="number" step="0.01" placeholder="输入最新余额" class="flex-1 p-2.5 rounded-lg border bg-gray-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:ring-2 focus:ring-green-500 outline-none font-mono text-sm" required>
                        <button type="submit" class="px-5 py-2.5 rounded-lg bg-green-600 hover:bg-green-700 text-white font-medium text-sm transition-colors shadow-sm">更新</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. 配置与状态 ---
        const DEFAULT_CATEGORIES = [
            {
                id: 'ai', title: 'AI 助手', iconName: 'brain', color: 'text-purple-500',
                links: [
                    { name: 'ChatGPT', url: 'https://chat.openai.com/', iconName: 'brain' },
                    { name: 'Claude', url: 'https://claude.ai/', iconName: 'cpu' },
                    { name: 'Gemini', url: 'https://gemini.google.com/', iconName: 'sparkles' },
                ]
            },
            {
                id: 'research', title: '学术 & 科研', iconName: 'graduation-cap', color: 'text-blue-500',
                links: [
                    { name: 'Google Scholar', url: 'https://scholar.google.com/', iconName: 'book-open' },
                    { name: 'ArXiv', url: 'https://arxiv.org/', iconName: 'book-open' },
                    { name: 'Papers w/ Code', url: 'https://paperswithcode.com/', iconName: 'code-2' },
                ]
            },
            {
                id: 'dev', title: '开发社区', iconName: 'terminal', color: 'text-emerald-500',
                links: [
                    { name: 'GitHub', url: 'https://github.com/', iconName: 'github' },
                    { name: 'Stack Overflow', url: 'https://stackoverflow.com/', iconName: 'code-2' },
                    { name: 'V2EX', url: 'https://www.v2ex.com/', iconName: 'globe' },
                ]
            },
            {
                id: 'ent', title: '摸鱼时间', iconName: 'coffee', color: 'text-orange-500',
                links: [
                    { name: 'Bilibili', url: 'https://www.bilibili.com/', iconName: 'monitor-play' },
                    { name: 'YouTube', url: 'https://www.youtube.com/', iconName: 'youtube' },
                    { name: '抖音', url: 'https://www.douyin.com/', iconName: 'monitor-play' },
                ]
            }
        ];

        const AVAILABLE_ICONS = ['globe', 'code-2', 'book-open', 'monitor-play', 'sparkles', 'github', 'cpu', 'brain', 'coffee', 'wallet'];

        let state = {
            categories: JSON.parse(localStorage.getItem('myStartPageData')) || DEFAULT_CATEGORIES,
            isEditing: false,
            searchEngine: 'google',
            isDarkMode: localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches),
            activeAddCategoryId: null,
            selectedIconForAdd: 'globe',
            financeLogs: JSON.parse(localStorage.getItem('myFinanceLogs')) || []
        };

        // --- 2. 核心功能函数 ---

        function init() {
            if (state.isDarkMode) document.documentElement.classList.add('dark');
            
            updateClock();
            setInterval(updateClock, 1000);
            
            renderCategories();
            updateEngineUI();
            lucide.createIcons();
            
            document.getElementById('search-input').focus();
        }

        function saveState() {
            localStorage.setItem('myStartPageData', JSON.stringify(state.categories));
        }
        
        function saveFinance() {
            localStorage.setItem('myFinanceLogs', JSON.stringify(state.financeLogs));
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock-time').innerText = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
            document.getElementById('date-display').innerText = now.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric', weekday: 'long' });
            
            const hour = now.getHours();
            let greet = '';
            if (hour < 5) greet = '注意休息';
            else if (hour < 11) greet = '早安，计算机研究生';
            else if (hour < 13) greet = '午饭时间';
            else if (hour < 18) greet = '下午好，代码写得顺吗？';
            else if (hour < 23) greet = '晚上好，享受自由时间';
            else greet = '夜深了，早点睡';
            document.getElementById('greeting-text').innerText = greet;
        }

        function toggleTheme() {
            state.isDarkMode = !state.isDarkMode;
            if (state.isDarkMode) {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            }
        }

        function toggleEditMode() {
            state.isEditing = !state.isEditing;
            const btn = document.getElementById('btn-edit');
            const main = document.getElementById('main-container');
            const searchContainer = document.getElementById('search-container');
            const greeting = document.getElementById('greeting-section');
            const btnReset = document.getElementById('btn-reset');

            if (state.isEditing) {
                btn.className = "p-2 rounded-full transition-all duration-300 flex items-center gap-2 bg-blue-100 text-blue-600 ring-2 ring-blue-500";
                document.getElementById('icon-settings').classList.add('hidden');
                document.getElementById('icon-check').classList.remove('hidden');
                document.getElementById('text-edit-done').classList.remove('hidden');
                
                main.classList.add('scale-95');
                searchContainer.classList.add('opacity-40', 'pointer-events-none', 'grayscale');
                greeting.classList.add('opacity-50', 'blur-[1px]');
                btnReset.classList.remove('hidden');
            } else {
                btn.className = "p-2 rounded-full transition-all duration-300 flex items-center gap-2 bg-white hover:bg-gray-100 text-slate-600 shadow-sm dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-400";
                document.getElementById('icon-settings').classList.remove('hidden');
                document.getElementById('icon-check').classList.add('hidden');
                document.getElementById('text-edit-done').classList.add('hidden');
                
                main.classList.remove('scale-95');
                searchContainer.classList.remove('opacity-40', 'pointer-events-none', 'grayscale');
                greeting.classList.remove('opacity-50', 'blur-[1px]');
                btnReset.classList.add('hidden');
            }
            renderCategories();
        }

        function updateEngineUI() {
            const input = document.getElementById('search-input');
            const btns = document.querySelectorAll('.engine-btn');

            btns.forEach(btn => {
                const engine = btn.dataset.engine;
                if (engine === state.searchEngine) {
                    btn.className = 'engine-btn px-3 py-1 rounded-full text-xs font-bold transition-all duration-200 bg-white text-blue-600 shadow-sm dark:bg-slate-600 dark:text-white';
                } else {
                    btn.className = 'engine-btn px-3 py-1 rounded-full text-xs font-bold transition-all duration-200 text-gray-400 hover:text-gray-600 dark:text-slate-400 dark:hover:text-slate-200';
                }
            });

            input.placeholder = `Search ${state.searchEngine === 'google' ? 'Google' : 'Bing'}...`;
        }

        // --- 财务逻辑 (整合到弹窗中) ---

        window.openFinanceModal = () => {
            document.getElementById('modal-finance').classList.remove('hidden');
            
            // 1. 获取最新余额
            const lastLog = state.financeLogs.length > 0 
                ? state.financeLogs[state.financeLogs.length - 1] 
                : { balance: 0 };
            
            // 更新弹窗上的显示数据
            document.getElementById('modal-finance-balance').innerText = '¥ ' + parseFloat(lastLog.balance).toLocaleString('zh-CN', {minimumFractionDigits: 2});

            // 2. 计算本月支出
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            const thisMonthLogs = state.financeLogs.filter(log => {
                const d = new Date(log.date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            }).sort((a, b) => new Date(a.date) - new Date(b.date));

            let totalSpent = 0;
            for (let i = 1; i < thisMonthLogs.length; i++) {
                const prev = thisMonthLogs[i-1].balance;
                const curr = thisMonthLogs[i].balance;
                if (curr < prev) {
                    totalSpent += (prev - curr);
                }
            }
            document.getElementById('modal-finance-spent').innerText = '¥ ' + totalSpent.toLocaleString('zh-CN', {minimumFractionDigits: 2});

            // 预填输入框
            const input = document.getElementById('input-balance');
            input.value = lastLog.balance || '';
            input.focus();
        };

        window.closeFinanceModal = () => {
            document.getElementById('modal-finance').classList.add('hidden');
        };

        document.getElementById('form-finance').addEventListener('submit', (e) => {
            e.preventDefault();
            const balanceVal = parseFloat(document.getElementById('input-balance').value);
            if (isNaN(balanceVal)) return;

            // 记录日志
            const newLog = {
                date: new Date().toISOString(),
                balance: balanceVal
            };
            
            state.financeLogs.push(newLog);
            state.financeLogs.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            saveFinance();
            
            // 重新刷新弹窗数据（给用户即时反馈）
            openFinanceModal();
            
            // 可选：更新后自动关闭，或者给个提示。这里选择更新数据但不关闭，方便查看结果。
            // closeFinanceModal(); 
        });


        // --- UI 渲染 ---

        function renderCategories() {
            const grid = document.getElementById('categories-grid');
            grid.innerHTML = '';

            state.categories.forEach(cat => {
                const card = document.createElement('div');
                card.className = `p-5 rounded-2xl border transition-all duration-300 h-full relative backdrop-blur-sm ${
                    state.isDarkMode 
                    ? 'bg-slate-800/50 border-slate-700/50' 
                    : 'bg-white/60 border-gray-100'
                } ${!state.isEditing ? 'hover:shadow-lg hover:-translate-y-1' : ''}`;

                let linksHtml = '';
                cat.links.forEach((link, idx) => {
                    linksHtml += `
                        <div class="relative group/item">
                            <a href="${state.isEditing ? 'javascript:void(0)' : link.url}" 
                               target="${state.isEditing ? '' : '_blank'}"
                               class="flex items-center gap-3 p-2 rounded-lg transition-all duration-200 group/link ${
                                   state.isEditing 
                                   ? 'cursor-default opacity-80 border border-dashed border-gray-300 dark:border-slate-600' 
                                   : (state.isDarkMode ? 'text-slate-400 hover:text-white hover:bg-slate-700/50' : 'text-gray-600 hover:text-blue-600 hover:bg-blue-50')
                               }">
                                <div class="w-6 h-6 flex items-center justify-center rounded-md transition-colors text-xs shrink-0 ${state.isDarkMode ? 'bg-slate-700 text-slate-300' : 'bg-gray-100 text-gray-500'}">
                                    <i data-lucide="${link.iconName || 'globe'}" class="w-4 h-4"></i>
                                </div>
                                <span class="text-sm font-medium truncate">${link.name}</span>
                            </a>
                            ${state.isEditing ? `
                                <button onclick="deleteLink('${cat.id}', ${idx})" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-md hover:bg-red-600 transition-colors z-10 scale-0 group-hover/item:scale-100">
                                    <i data-lucide="x" class="w-3 h-3"></i>
                                </button>
                            ` : ''}
                        </div>
                    `;
                });

                if (state.isEditing) {
                    linksHtml += `
                        <button onclick="openAddModal('${cat.id}')" class="w-full flex items-center justify-center gap-2 p-2 rounded-lg border border-dashed transition-all duration-200 mt-2 ${
                            state.isDarkMode 
                            ? 'border-slate-600 text-slate-500 hover:text-slate-300 hover:border-slate-400' 
                            : 'border-gray-300 text-gray-400 hover:text-blue-500 hover:border-blue-400'
                        }">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            <span class="text-xs font-medium">Add Link</span>
                        </button>
                    `;
                }

                card.innerHTML = `
                    <div class="flex items-center gap-2 mb-4">
                        <div class="${cat.color} opacity-80">
                            <i data-lucide="${cat.iconName}" class="w-5 h-5"></i>
                        </div>
                        <h2 class="font-semibold text-sm tracking-wide uppercase ${state.isDarkMode ? 'text-slate-300' : 'text-gray-500'}">${cat.title}</h2>
                    </div>
                    <div class="space-y-2">${linksHtml}</div>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        // --- 事件监听 ---

        document.getElementById('search-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const term = document.getElementById('search-input').value.trim();
            if (!term) return;
            const url = state.searchEngine === 'google' 
                ? `https://www.google.com/search?q=${encodeURIComponent(term)}`
                : `https://www.bing.com/search?q=${encodeURIComponent(term)}`;
            window.location.href = url;
        });

        document.querySelectorAll('.engine-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                state.searchEngine = btn.dataset.engine;
                updateEngineUI();
                document.getElementById('search-input').focus();
            });
        });

        document.getElementById('btn-theme').addEventListener('click', toggleTheme);
        document.getElementById('btn-edit').addEventListener('click', toggleEditMode);
        document.getElementById('btn-reset').addEventListener('click', () => {
            if (confirm('确定要恢复默认设置吗？')) {
                state.categories = JSON.parse(JSON.stringify(DEFAULT_CATEGORIES));
                saveState();
                toggleEditMode();
            }
        });

        // 弹窗逻辑
        window.openAddModal = (catId) => {
            state.activeAddCategoryId = catId;
            document.getElementById('modal-add-link').classList.remove('hidden');
            document.getElementById('input-link-name').focus();
            renderIconSelector();
        }

        document.getElementById('btn-cancel-add').addEventListener('click', () => {
            document.getElementById('modal-add-link').classList.add('hidden');
            document.getElementById('form-add-link').reset();
            state.selectedIconForAdd = 'globe';
        });

        function renderIconSelector() {
            const container = document.getElementById('icon-selector');
            container.innerHTML = '';
            AVAILABLE_ICONS.forEach(iconName => {
                const btn = document.createElement('button');
                btn.type = 'button';
                const isSelected = state.selectedIconForAdd === iconName;
                btn.className = `p-2 rounded-lg border transition-all ${
                    isSelected 
                    ? 'bg-blue-100 border-blue-500 text-blue-600 dark:bg-blue-900/30 dark:border-blue-400 dark:text-blue-300' 
                    : 'border-transparent hover:bg-gray-100 dark:hover:bg-slate-700 dark:text-slate-400'
                }`;
                btn.innerHTML = `<i data-lucide="${iconName}" class="w-5 h-5"></i>`;
                btn.onclick = () => {
                    state.selectedIconForAdd = iconName;
                    renderIconSelector();
                };
                container.appendChild(btn);
            });
            lucide.createIcons();
        }

        document.getElementById('form-add-link').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('input-link-name').value;
            let url = document.getElementById('input-link-url').value;
            if (name && url) {
                if (!url.startsWith('http')) url = 'https://' + url;
                const newLink = { name, url, iconName: state.selectedIconForAdd };
                state.categories = state.categories.map(cat => {
                    if (cat.id === state.activeAddCategoryId) return { ...cat, links: [...cat.links, newLink] };
                    return cat;
                });
                saveState();
                renderCategories();
                document.getElementById('modal-add-link').classList.add('hidden');
                document.getElementById('form-add-link').reset();
            }
        });

        window.deleteLink = (catId, index) => {
            if (confirm('确定删除?')) {
                state.categories = state.categories.map(cat => {
                    if (cat.id === catId) {
                        const newLinks = [...cat.links];
                        newLinks.splice(index, 1);
                        return { ...cat, links: newLinks };
                    }
                    return cat;
                });
                saveState();
                renderCategories();
            }
        };

        init();
    </script>
</body>

</html>


